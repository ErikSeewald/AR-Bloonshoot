let DeviceMotionCamera=pc.createScript("deviceMotionCamera");DeviceMotionCamera.attributes.add("startEvent",{type:"string",title:"Start Event"}),DeviceMotionCamera.attributes.add("adjustHeading",{type:"boolean",title:"Adjust for Heading",default:!1}),DeviceMotionCamera.attributes.add("trackAcceleration",{type:"boolean",title:"Track Device Acceleration",default:!1});const isIOS=!(navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)),LEFT90=(new pc.Quat).setFromAxisAngle(pc.Vec3.LEFT,90);DeviceMotionCamera.prototype.initialize=function(){this.first=!0,this.acc=new pc.Vec3(0,0,0),this.speed=new pc.Vec3(0,0,0),this.previousHeadingOffset=0,this.currentHeadingOffset=0,this.app.on(this.startEvent,this.initSensors,this)},DeviceMotionCamera.prototype.initSensors=function(t){if(void 0===window.orientation)return console.log("Orientation could not find mobile device"),void t(!0);const handleDeviceOrientationChange=t=>{null!==t.alpha&&void 0!==t.alpha&&(this.orientationData=t)},handleDeviceOrientationChangeAbsolute=t=>{null!==t.alpha&&void 0!==t.alpha&&(this.absData=t)},handleDeviceMotionEvent=t=>{this.trackAcceleration&&(this.entity.translate(this.entity.forward.mulScalar(this.speed.z*t.interval)),this.entity.translate(this.entity.right.mulScalar(-this.speed.x*t.interval)),this.entity.translate(this.entity.up.mulScalar(-this.speed.y*t.interval)),this.speed.add(this.acc.clone().mulScalar(t.interval)),this.acc=new pc.Vec3(t.acceleration.x,t.acceleration.y,t.acceleration.z))},init=()=>{this.app.permissionsGiven=!0,this.adjustHeading&&"ondeviceorientationabsolute"in window&&window.addEventListener("deviceorientationabsolute",handleDeviceOrientationChangeAbsolute,!1),"ondeviceorientation"in window&&window.addEventListener("deviceorientation",handleDeviceOrientationChange,!1),this.trackAcceleration&&window.addEventListener("devicemotion",handleDeviceMotionEvent,!1),t()};window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e?init():(console.error(`dosen't understand response ${e}`),t(!0))})).catch((e=>{console.error(e),t(!0)})):init()},DeviceMotionCamera.prototype.fromOrientation=function({alpha:t,beta:e,gamma:i},a){const n=(new pc.Quat).setFromAxisAngle(pc.Vec3.UP,t),o=(new pc.Quat).setFromAxisAngle(pc.Vec3.RIGHT,e),s=(new pc.Quat).setFromAxisAngle(pc.Vec3.FORWARD,i);let r=n.mul(o).mul(s).mul(LEFT90);if(a){const t=r.transformVector(pc.Vec3.FORWARD);r=(new pc.Quat).setFromAxisAngle(t,a).mul(r)}return r},DeviceMotionCamera.prototype.updateTransform=function(t){if(this.orientationData&&(this.orientationData.webkitCompassHeading?(this.heading=this.orientationData.webkitCompassHeading,this.headingAvailable=!0):this.absData&&(this.heading=Math.abs(this.absData.alpha-360),this.headingAvailable=!0),this.alphaOffset=0,this.rot=this.fromOrientation(this.orientationData,window.orientation),this.rot&&(this.entity.setRotation(this.rot),this.headingAvailable))){let e=this.entity.getRotation().clone(),i=this.getYaw(e);i=i<0?360+i:i,this.headingOffset=360-this.heading-i,this.headingOffset<0&&(this.headingOffset=360+this.headingOffset),this.headingDiff=this.headingOffset-this.previousHeadingOffset,Math.abs(this.headingDiff)>15?this.currentHeadingOffset=this.headingOffset:Math.abs(this.headingDiff)>5&&(this.currentHeadingOffset+=this.headingDiff*t),this.entity.rotate(0,this.currentHeadingOffset,0),this.previousHeadingOffset=this.headingOffset}};var _transformedForward=new pc.Vec3;DeviceMotionCamera.prototype.getYaw=function(t){var e=_transformedForward;return t.transformVector(pc.Vec3.FORWARD,e),Math.atan2(-e.x,-e.z)*pc.math.RAD_TO_DEG},DeviceMotionCamera.prototype.computeCompassHeading=function(t,e,i){var a=t*(Math.PI/180),n=e*(Math.PI/180),o=i*(Math.PI/180),s=Math.cos(a),r=Math.sin(a),h=Math.sin(n),c=Math.cos(o),d=Math.sin(o),l=-s*d-r*h*c,p=-r*d+s*h*c,f=Math.atan(l/p);return p<0?f+=Math.PI:l<0&&(f+=2*Math.PI),f*=180/Math.PI},DeviceMotionCamera.prototype.update=function(t){this.updateTransform(t)};var CameraBackground=pc.createScript("cameraBackground");CameraBackground.attributes.add("permissionEvent",{title:"Camera Permission Event Name",description:"Event to listen for.",type:"string"}),CameraBackground.attributes.add("startEvent",{title:"Start Event Name",description:"Event to listen for.",type:"string"}),CameraBackground.prototype.initialize=function(){var e=this;this.app.on(this.permissionEvent,(t=>{navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",advanced:[{zoom:2,focusMode:"continuous"}]}}).then((function(a){e.app.cameraAccess=!0,e.videoPlaying=!1;var i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.setAttribute("playsinline",""),i.srcObject=a,e.video=i,e.app.graphicsDevice.on("resizecanvas",(function(){})),i.addEventListener("resize",(function(){})),i.addEventListener("canplay",(function(){e.canplay=!0,t()}))})).catch((function(a){a&&console.error("ERROR: Unable to acquire camera stream"),e.app.cameraAccess=!1,t(a)}))}),this),this.app.on(this.startEvent,(()=>{e.startVideo(),e.videoPlaying=!0,console.log("Starting Video...")}),this)},CameraBackground.prototype.update=function(e){},CameraBackground.prototype.startVideo=function(){var e=this.video.style;e.position="absolute",e.top="50%",e.left="50%",e.width="auto",e.height="auto",e.minWidth="100%",e.minHeight="100%",e.backgroundSize="cover",e.overflow="hidden",e.transform="translate(-50%, -50%)",e.zIndex="0",document.body.appendChild(this.video),this.app.graphicsDevice.canvas.style.zIndex="1"};let ButtonClick=pc.createScript("buttonClick");ButtonClick.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.app.fire(this.initEvent,(()=>this.update()))}),this)},ButtonClick.attributes.add("initEvent",{type:"string",title:"Init Event"}),ButtonClick.prototype.update=function(t){};let LevelLoader=pc.createScript("levelLoader");class Level_1{constructor(){this.Balloon_Count=46,this.Balloons=[4,5,1,4,5,2,4,6,1,4,6,2,5,5,1,5,5,2,5,6,1,5,6,2,19,9,6,19,10,6,19,11,6,19,12,6,20,9,6,20,10,6,20,11,6,20,12,6,24,5,6,24,6,6,25,5,6,25,6,6,26,5,6,26,6,6,27,5,6,27,6,6,20,25,6,20,26,7,21,27,8,23,21,3,24,22,2,25,23,1,5,17,1,5,17,2,5,17,3,5,17,4,5,18,1,5,18,2,5,18,3,5,18,4,11,23,1,11,23,2,11,23,3,11,23,4,12,23,1,12,23,2,12,23,3,12,23,4]}getBalloonCount(){return this.Balloon_Count}getBalloon(o){return this.Balloons[o]}getBlockCount(){}getBlock(o){}getBoomBalloonCount(){}getBoomBalloon(o){}getBounceBlockCount(){}getBounceBlock(o){}getWoodBlockCount(){}getWoodBlock(o){}}class Level_2{constructor(){this.Balloon_Count=72,this.Balloons=[9,7,1,9,7,2,9,7,3,9,7,4,10,7,1,10,7,2,10,7,3,10,7,4,11,7,1,11,7,2,11,7,3,11,7,4,12,7,1,12,7,2,12,7,3,12,7,4,24,5,1,24,6,1,25,5,1,25,6,1,26,5,1,26,6,1,27,5,1,27,6,1,20,21,1,20,21,2,20,22,1,20,22,2,21,21,1,21,21,2,21,22,1,21,22,2,25,26,1,25,26,2,25,26,3,25,26,4,25,27,1,25,27,2,25,27,3,25,27,4,26,26,1,26,26,2,26,26,3,26,26,4,26,27,1,26,27,2,26,27,3,26,27,4,5,17,1,5,17,2,5,17,3,5,17,4,5,18,1,5,18,2,5,18,3,5,18,4,7,21,6,7,22,6,7,23,6,7,24,6,8,21,6,8,22,6,8,23,6,8,24,6,9,21,6,9,22,6,9,23,6,9,24,6,10,21,6,10,22,6,10,23,6,10,24,6],this.Block_Count=30,this.Blocks=[12,11,3,12,11,5,13,10,3,13,10,5,13,11,3,13,11,5,20,10,3,21,11,5,24,9,4,23,11,3,21,24,1,21,24,2,21,24,3,21,24,4,23,22,1,23,22,2,23,22,3,23,22,4,7,23,7,7,24,7,8,23,7,8,24,7,9,19,1,9,19,2,9,19,3,9,19,4,10,18,1,10,18,2,10,18,3,10,18,4]}getBalloonCount(){return this.Balloon_Count}getBalloon(o){return this.Balloons[o]}getBlockCount(){return this.Block_Count}getBlock(o){return this.Blocks[o]}getBoomBalloonCount(){}getBoomBalloon(o){}getBounceBlockCount(){}getBounceBlock(o){}getWoodBlockCount(){}getWoodBlock(o){}}class Level_3{constructor(){this.Balloon_Count=81,this.Balloons=[4,4,2,4,4,3,4,5,2,4,6,2,4,6,3,4,7,2,4,7,3,5,4,2,5,4,3,5,5,2,5,5,3,5,6,2,5,6,3,5,7,2,5,7,3,6,4,2,6,4,3,6,5,2,6,5,3,6,6,2,6,6,3,6,7,2,6,7,3,7,4,2,7,4,3,7,5,2,7,5,3,7,6,2,7,6,3,7,7,2,7,7,3,22,5,1,22,6,1,23,3,1,23,4,1,23,5,1,23,6,1,24,3,1,24,4,1,24,5,1,24,6,1,25,3,1,25,4,1,25,5,1,26,3,1,26,4,1,26,5,1,26,6,1,27,3,1,27,4,1,21,23,2,21,23,3,21,23,4,22,22,2,22,22,3,22,22,4,22,24,2,22,24,3,22,24,4,23,23,2,23,23,3,23,23,4,23,25,2,23,25,3,23,25,4,24,24,2,24,24,3,24,24,4,4,22,5,5,25,6,5,26,7,6,20,6,6,21,7,6,22,6,6,26,5,6,27,8,7,22,6,7,26,6,8,23,5],this.Block_Count=10,this.Blocks=[19,11,1,19,11,2,19,11,3,20,12,1,20,12,2,20,12,3,7,23,3,8,24,8,9,24,6,10,25,3],this.BounceBlock_Count=41,this.BounceBlocks=[3,4,2,3,4,3,3,5,2,3,5,3,3,6,2,3,6,3,4,3,2,4,3,3,5,3,2,5,3,3,6,3,2,6,3,3,6,6,0,6,7,0,7,6,0,7,7,0,22,6,6,22,7,6,23,6,6,23,7,6,20,24,2,20,24,3,20,24,4,21,25,2,21,25,3,21,25,4,22,26,2,22,26,3,22,26,4,23,21,2,23,21,3,23,21,4,24,22,2,24,22,3,24,22,4,25,23,2,25,23,3,25,23,4,4,25,5,6,25,9,9,26,4]}getBalloonCount(){return this.Balloon_Count}getBalloon(o){return this.Balloons[o]}getBlockCount(){return this.Block_Count}getBlock(o){return this.Blocks[o]}getBoomBalloonCount(){}getBoomBalloon(o){}getBounceBlockCount(){return this.BounceBlock_Count}getBounceBlock(o){return this.BounceBlocks[o]}getWoodBlockCount(){}getWoodBlock(o){}}class Level_4{constructor(){this.Balloon_Count=74,this.Balloons=[4,5,2,4,6,2,4,6,3,5,4,2,5,4,3,5,5,2,5,5,3,5,6,2,5,6,3,5,7,2,5,7,3,6,4,2,6,4,3,6,6,2,6,6,3,6,7,2,6,7,3,7,4,2,7,4,3,7,5,2,7,5,3,7,6,2,7,6,3,23,3,3,23,4,3,23,5,3,24,3,3,24,4,3,24,6,3,25,3,3,25,5,3,25,6,3,26,4,3,26,5,3,26,6,3,17,27,4,17,28,5,18,27,3,18,28,4,19,28,4,22,22,2,22,22,3,22,22,4,22,23,2,22,23,3,22,23,4,23,16,4,23,22,2,23,22,3,23,22,4,24,16,4,26,16,4,5,22,2,5,22,3,5,23,2,5,23,3,5,24,2,5,24,3,6,22,2,6,22,3,6,23,2,6,23,3,6,24,2,6,24,3,7,21,2,7,21,3,7,22,2,7,22,3,7,23,2,7,23,3,7,24,2,7,24,3,8,22,2,8,22,3],this.Block_Count=10,this.Blocks=[17,26,3,19,27,5,6,19,2,6,19,3,7,20,2,7,20,3,9,22,2,9,22,3,10,23,2,10,23,3],this.BounceBlock_Count=11,this.BounceBlocks=[21,4,3,22,5,3,23,6,3,24,7,3,25,8,3,21,23,2,21,23,3,21,23,4,23,21,2,23,21,3,23,21,4],this.WoodBlock_Count=29,this.WoodBlocks=[5,8,2,5,8,3,6,8,2,6,8,3,7,8,2,7,8,3,8,5,2,8,5,3,8,6,2,8,6,3,8,7,2,8,7,3,23,3,4,23,4,4,23,5,4,24,3,4,24,4,4,24,5,4,24,6,4,25,3,4,25,4,4,25,5,4,25,6,4,26,4,4,26,5,4,26,6,4,22,16,4,8,21,2,8,21,3]}getBalloonCount(){return this.Balloon_Count}getBalloon(o){return this.Balloons[o]}getBlockCount(){return this.Block_Count}getBlock(o){return this.Blocks[o]}getBoomBalloonCount(){}getBoomBalloon(o){}getBounceBlockCount(){return this.BounceBlock_Count}getBounceBlock(o){return this.BounceBlocks[o]}getWoodBlockCount(){return this.WoodBlock_Count}getWoodBlock(o){return this.WoodBlocks[o]}}class Level_5{constructor(){this.Balloon_Count=132,this.Balloons=[4,5,2,4,6,2,4,6,3,5,4,2,5,4,3,5,5,2,5,5,3,5,6,2,5,6,3,5,7,2,5,7,3,6,4,2,6,4,3,6,6,2,6,7,2,6,7,3,7,4,2,7,4,3,7,5,2,7,5,3,7,6,2,7,6,3,24,4,3,24,5,3,24,6,3,24,7,3,25,4,3,25,5,3,25,6,3,25,7,3,26,5,3,26,6,3,26,7,3,19,23,6,19,24,6,20,20,4,20,21,4,20,22,2,20,23,2,20,24,2,21,22,2,21,23,2,21,24,2,22,22,2,22,23,2,22,24,2,4,24,2,4,24,3,4,24,4,4,25,2,4,25,3,4,25,4,5,23,2,5,23,3,5,23,4,5,24,2,5,24,3,5,24,4,5,25,2,5,25,3,5,25,4,5,26,2,5,26,3,5,26,4,6,22,2,6,22,3,6,22,4,6,23,2,6,23,3,6,23,4,6,24,2,6,24,3,6,24,4,6,25,2,6,26,2,6,26,3,6,26,4,7,21,2,7,21,3,7,21,4,7,22,2,7,22,3,7,22,4,7,23,2,7,24,2,7,24,3,7,24,4,7,25,2,7,25,3,7,25,4,8,21,2,8,21,3,8,21,4,8,22,2,8,22,3,8,22,4,8,23,2,8,23,3,8,23,4,8,24,2,8,24,3,8,24,4,8,25,2,9,22,2,9,22,3,9,22,4,9,23,2,9,24,2,9,24,3,9,24,4,9,25,2,9,25,3,9,25,4,9,26,2,9,26,3,9,26,3,10,23,2,10,23,3,10,23,4,10,24,2,10,24,3,10,24,4,10,25,2,10,26,2,10,26,3,10,26,4,11,24,2,11,24,3,11,24,4,11,25,2,11,25,3,11,25,4],this.Block_Count=2,this.Blocks=[22,8,2,22,8,3],this.BoomBalloon_Count=8,this.BoomBalloons=[6,6,3,26,4,3,21,23,3,6,25,3,7,23,3,8,25,3,9,23,3,10,25,3],this.BounceBlock_Count=3,this.BounceBlocks=[23,7,6,19,25,6,20,19,4],this.WoodBlock_Count=6,this.WoodBlocks=[24,8,2,24,8,3,25,8,2,25,8,3,26,8,2,26,8,3]}getBalloonCount(){return this.Balloon_Count}getBalloon(o){return this.Balloons[o]}getBlockCount(){return this.Block_Count}getBlock(o){return this.Blocks[o]}getBoomBalloonCount(){return this.BoomBalloon_Count}getBoomBalloon(o){return this.BoomBalloons[o]}getBounceBlockCount(){return this.BounceBlock_Count}getBounceBlock(o){return this.BounceBlocks[o]}getWoodBlockCount(){return this.WoodBlock_Count}getWoodBlock(o){return this.WoodBlocks[o]}}LevelLoader.attributes.add("next_level_Event",{title:"Next Level Event Name",description:"Event to listen for.",type:"string"}),LevelLoader.prototype.initialize=function(){this.app.levelNum=0,this.loadLevel(),this.app.on(this.next_level_Event,(()=>{this.loadLevel()}),this)},LevelLoader.prototype.createRoot=function(){this.root=new pc.Entity,this.root.name="level_root",this.entity.addChild(this.root)},LevelLoader.prototype.loadLevel=function(){let o,t;switch(this.root&&this.root.destroy(),this.createRoot(),this.app.levelNum++,this.app.levelNum>5&&(this.app.levelNum=1),this.app.levelNum){case 2:o=new Level_2;break;case 3:o=new Level_3;break;case 4:o=new Level_4;break;case 5:o=new Level_5;break;default:o=new Level_1}for(console.log("Balloons:"),i=0;i<o.getBalloonCount();i++){j=3*i;let e=Math.floor(10*Math.random())%4;switch(e){case 0:t=115088419;break;case 1:t=115085709;break;case 2:t=115091807;break;case 3:t=115090315}let l=this.app.assets.get(t).resource.instantiate();switch(l.setPosition(new pc.Vec3(-o.getBalloon(j),o.getBalloon(j+2),o.getBalloon(j+1))),l.name="Level"+this.app.levelNum+" "+l.getPosition().x+" "+l.getPosition().y+" "+l.getPosition().z,console.log(l.name),l.tags.add("Balloon"),e){case 0:l.tags.add("RED");break;case 1:l.tags.add("GREEN");break;case 2:l.tags.add("BLUE");break;case 3:l.tags.add("YELLOW")}this.root.addChild(l)}for(console.log("Blocks:"),i=0;i<o.getBlockCount();i++){j=3*i,t=114999129;let e=this.app.assets.get(t).resource.instantiate();e.setPosition(new pc.Vec3(-o.getBlock(j),o.getBlock(j+2),o.getBlock(j+1))),e.name="Level"+this.app.levelNum+" "+e.getPosition().x+" "+e.getPosition().y+" "+e.getPosition().z,console.log(e.name),e.tags.add("Block"),this.root.addChild(e)}for(console.log("BoomBalloons:"),i=0;i<o.getBoomBalloonCount();i++){j=3*i,t=115003715;let e=this.app.assets.get(t).resource.instantiate();e.setPosition(new pc.Vec3(-o.getBoomBalloon(j),o.getBoomBalloon(j+2),o.getBoomBalloon(j+1))),e.name="Level"+this.app.levelNum+" "+e.getPosition().x+" "+e.getPosition().y+" "+e.getPosition().z,console.log(e.name),e.tags.add("BoomBalloon"),this.root.addChild(e)}for(console.log("BounceBlocks:"),i=0;i<o.getBounceBlockCount();i++){j=3*i,t=115000591;let e=this.app.assets.get(t).resource.instantiate();e.setPosition(new pc.Vec3(-o.getBounceBlock(j),o.getBounceBlock(j+2),o.getBounceBlock(j+1))),e.name="Level"+this.app.levelNum+" "+e.getPosition().x+" "+e.getPosition().y+" "+e.getPosition().z,console.log(e.name),e.tags.add("BounceBlock"),this.root.addChild(e)}for(console.log("WoodBlocks:"),i=0;i<o.getWoodBlockCount();i++){j=3*i,t=115002746;let e=this.app.assets.get(t).resource.instantiate();e.setPosition(new pc.Vec3(-o.getWoodBlock(j),o.getWoodBlock(j+2),o.getWoodBlock(j+1))),e.name="Level"+this.app.levelNum+" "+e.getPosition().x+" "+e.getPosition().y+" "+e.getPosition().z,console.log(e.name),e.tags.add("WoodBlock"),this.root.addChild(e)}};let Touch=pc.createScript("touch");Touch.prototype.initialize=function(){this.prevScreenPosY=-1,this.locOrigin=new pc.Vec3,this.locOrigin.x=this.entity.getLocalPosition().x,this.locOrigin.y=this.entity.getLocalPosition().y,this.locOrigin.z=this.entity.getLocalPosition().z,this.hitBoxOrigin=new pc.Vec3,this.hitBoxOrigin.x=this.entity.parent.getLocalPosition().x,this.hitBoxOrigin.y=this.entity.parent.getLocalPosition().y,this.hitBoxOrigin.z=this.entity.parent.getLocalPosition().z,this.hitBoxRot=new pc.Quat,this.hitBoxRot.x=this.entity.parent.getLocalRotation().x,this.hitBoxRot.y=this.entity.parent.getLocalRotation().y,this.hitBoxRot.z=this.entity.parent.getLocalRotation().z,this.returnVec=new pc.Vec3,this.isReturning=!0,this.returnSteps=0,this.initialization=!0,this.legalTouch=!1,this.cameraEntity=this.app.root.findByName("camera");let t=this.app.touch;t&&(t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),t.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)),this.on("destroy",(function(){t.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),t.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.off(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this)}),this)},Touch.prototype.updateFromScreen=function(t){if(t.y<screen.height/2.5||this.entity.script.shotHandler.isFlying)return void(this.legalTouch=!1);this.legalTouch=!0;let i=0;-1!=this.prevScreenPosY&&(i=this.prevScreenPosY-t.y),this.prevScreenPosY=t.y;let e=new pc.Vec3;e=this.entity.getLocalPosition(),e.y+=i/(screen.height/1.5),this.entity.setLocalPosition(e)},Touch.prototype.onTouchStart=function(t){1===t.touches.length&&this.updateFromScreen(t.touches[0]),t.event.preventDefault()},Touch.prototype.onTouchMove=function(t){this.updateFromScreen(t.touches[0]),t.event.preventDefault()},Touch.prototype.onTouchEnd=function(t){this.legalTouch&&(this.prevScreenPosY=-1,this.setReturnVec(),t.event.preventDefault())},Touch.prototype.onTouchCancel=function(t){this.legalTouch&&(this.prevScreenPosY=-1,this.setReturnVec(),t.event.preventDefault())},Touch.prototype.setReturnVec=function(){this.returnVec.x=this.entity.getLocalPosition().x-this.locOrigin.x,this.returnVec.y=this.entity.getLocalPosition().y-this.locOrigin.y,this.returnVec.z=this.entity.getLocalPosition().z-this.locOrigin.z,this.isReturning=!0},Touch.prototype.update=function(t){if(this.isReturning){let t=new pc.Vec3;t.x=this.entity.getLocalPosition().x-this.returnVec.x/5,t.y=this.entity.getLocalPosition().y-this.returnVec.y/5,t.z=this.entity.getLocalPosition().z-this.returnVec.z/5,this.entity.setLocalPosition(t),5==this.returnSteps&&(this.isReturning=!1,this.returnSteps=0,this.initialization?this.initialization=!1:(this.returnVec.y<-.8&&(this.returnVec.y=-.8),this.entity.script.shotHandler.start(this.returnVec))),this.returnSteps++}};let ShotHandler=pc.createScript("shotHandler");ShotHandler.prototype.initialize=function(){this.cameraEntity=this.app.root.findByName("camera"),this.startRotation=this.entity.getLocalRotation().clone(),this.isFlying=!1,this.balloonAnimation=!1,this.rotationValid=!0,this.stuckTimer=0,this.bounceBan=0,this.lightUpTimer=0,this.rotHitOffset=0},ShotHandler.prototype.start=function(t){this.speed=Math.abs(15*t.y);let i=this.cameraEntity.forward.x*this.speed-t.x*this.speed,e=this.cameraEntity.forward.y*this.speed-t.y*this.speed,o=this.cameraEntity.forward.z*this.speed-t.z*this.speed;this.entity.parent.rigidbody.type=pc.BODYTYPE_DYNAMIC,this.entity.parent.rigidbody.mass=1,this.entity.parent.rigidbody.applyImpulse(i,e,o),this.isFlying=!0},ShotHandler.prototype.rotateDown=function(){let t=this.entity.getLocalRotation();t.x-=.008,this.entity.setLocalRotation(t),this.rotHitOffset-=.012},ShotHandler.prototype.reset=function(){this.entity.setLocalRotation(this.startRotation),this.entity.parent.rigidbody.type=pc.BODYTYPE_KINEMATIC,this.isFlying=!1,this.rotHitOffset=0,this.entity.parent.setLocalPosition(this.entity.script.touch.hitBoxOrigin),this.entity.parent.setLocalRotation(this.entity.script.touch.hitBoxRot),this.rotationValid||(this.rotationValid=!0)},ShotHandler.prototype.update=function(t){if(this.balloonAnimation&&(this.pop.destroy(),this.balloonAnimation=!1),0!=this.stuckTimer)return this.stuckTimer--,0==this.stuckTimer&&this.reset(),void(this.entity.parent.rigidbody.mass=0);if(0!=this.bounceBan&&this.bounceBan--,0!=this.lightUpTimer&&(this.lightUpTimer--,0==this.lightUpTimer&&this.bounceblockLIGHT.destroy()),this.isFlying){if(this.entity.parent.getPosition().y<0)return void this.reset();this.rotationValid&&this.rotateDown();let t=this.entity.parent.getPosition().clone();t.y+=this.rotHitOffset;let i="Level"+this.app.levelNum+" "+Math.round(t.x)+" "+Math.round(t.y)+" "+Math.round(t.z),e=this.app.root.findByName(i);e&&(e.tags.has("Balloon")?this.balloonInteraction(e):e.tags.has("Block")?(this.entity.parent.rigidbody.linearVelocity=new pc.Vec3(0,0,0),this.rotationValid=!1,this.stuckTimer=50):e.tags.has("BounceBlock")&&this.bounceBlockInteraction(e))}},ShotHandler.prototype.balloonInteraction=function(t){let i;t.tags.has("RED")?i=116699927:t.tags.has("GREEN")?i=116699925:t.tags.has("BLUE")?i=116699922:t.tags.has("YELLOW")&&(i=116699929);let e=this.app.assets.get(i);this.pop=e.resource.instantiate(),this.pop.setPosition(t.getPosition()),this.app.root.findByName("level_root").addChild(this.pop),t.destroy(),this.balloonAnimation=!0},ShotHandler.prototype.bounceBlockInteraction=function(t){if(0!=this.bounceBan)return;let i=new pc.Vec3;i.x=.9*-this.entity.parent.rigidbody.linearVelocity.x,i.y=.9*-this.entity.parent.rigidbody.linearVelocity.y,i.z=.9*-this.entity.parent.rigidbody.linearVelocity.z;let e=this.app.assets.get(116719882);this.bounceblockLIGHT=e.resource.instantiate(),this.bounceblockLIGHT.setLocalPosition(t.getLocalPosition().clone()),this.app.root.findByName("level_root").addChild(this.bounceblockLIGHT),this.entity.parent.rigidbody.linearVelocity=i,this.bounceBan=25,this.lightUpTimer=20};